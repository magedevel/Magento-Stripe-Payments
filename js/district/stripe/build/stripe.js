var district=district||{};district.stripeCc=function($){var mageValidateParent,self={},$errorMsg=$("#stripe-error-messages"),$inputs={},address={};return self.init=function(){$inputs.cardNumber=$("#stripe-cc-number"),$inputs.cardExpiry=$("#stripe-cc-exp"),$inputs.cardCVC=$("#stripe-cc-cvc"),$inputs.cardToken=$("#stripe-token"),$inputs.savedCard=$("#stripe-saved-card"),$inputs.cardNumber.payment("formatCardNumber"),$inputs.cardExpiry.payment("formatCardExpiry"),$inputs.cardCVC.payment("formatCardCVC"),$.fn.toggleInputError=function(error){return this.parent().toggleClass("has-error",error),this},$("#stripe-saved-card").change(function(){"0"==$(this).val()?$("#stripe-new-card").show():$("#stripe-new-card").hide()}),"undefined"!=typeof Payment?(self.getBillingAddressFrontend(),Payment.prototype.save=Payment.prototype.save.wrap(self.validateForm)):"undefined"!=typeof AdminOrder&&(AdminOrder.prototype.submit=AdminOrder.prototype.submit.wrap(self.validateForm),AdminOrder.prototype.getPaymentData=AdminOrder.prototype.getPaymentData.wrap(self.paymentDataChange))},self.paymentDataChange=function(getPaymentData){self.getBillingAddressAdmin(),getPaymentData()},self.getBillingAddressFrontend=function(){var $billingAddress=$("#billing-address-select");$billingAddress.length&&""!=$billingAddress.val()?$.ajax({url:billing.addressUrl+$billingAddress.val()}).done(function(data){address.line1=data.street1,address.zip=data.postcode,address.country=data.country_id,address.name=data.firstname+" "+data.lastname}):(address.line1=$("#billing\\:street1").val(),address.zip=$("#billing\\:postcode").val(),address.country=$("#billing\\:country_id").val(),address.name=$("billing\\:firstname").val()+" "+$("billing\\:lastname").val())},self.getBillingAddressAdmin=function(){address.line1=$("#order-billing_address_street0").val(),address.zip=$("#order-billing_address_postcode").val(),address.country=$("#order-billing_address_country_id").val(),address.name=$("#order-billing_address_firstname").val()+" "+$("#order-billing_address_lastname").val()},self.validateForm=function(validateParent){if(mageValidateParent=validateParent,$inputs.savedCard.length&&"0"!=$inputs.savedCard.val())$inputs.cardToken.val($inputs.savedCard.val()),mageValidateParent();else{var validCardNumber=$.payment.validateCardNumber($inputs.cardNumber.val()),validCardExpiry=$.payment.validateCardExpiry($.payment.cardExpiryVal($inputs.cardExpiry.val())),validCardCVC=$.payment.validateCardCVC($inputs.cardCVC.val(),$.payment.cardType($inputs.cardNumber.val()));if($inputs.cardNumber.toggleInputError(!validCardNumber),$inputs.cardExpiry.toggleInputError(!validCardExpiry),$inputs.cardCVC.toggleInputError(!validCardCVC),!(validCardNumber&&validCardExpiry&&validCardCVC))return!1;self.createToken()}},self.createToken=function(){Stripe.card.createToken({number:$inputs.cardNumber.val(),exp:$inputs.cardExpiry.val(),cvc:$inputs.cardCVC.val(),address_country:address.country,address_line1:address.line1,address_zip:address.zip,name:address.name},self.stripeResponseHandler)},self.stripeResponseHandler=function(status,response){response.error?$errorMsg.html(response.error.message):($inputs.cardToken.val(response.id),mageValidateParent())},self}(district.$);